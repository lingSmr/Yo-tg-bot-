# Yo! Telegram Botü§ô

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

Yo! Telegram Bot ‚Äî —ç—Ç–æ –±–æ—Ç, –≤–¥–æ—Ö–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º "Bro!" –∏–∑ —Å–µ—Ä–∏–∞–ª–∞ "–ö—Ä–µ–º–Ω–∏–µ–≤–∞—è –¥–æ–ª–∏–Ω–∞".  
–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å –±–æ—Ç–∞ ‚Äî –¥–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–≤–æ–∏–º –¥—Ä—É–∑—å—è–º  **–ô–û–£!** üöÄ

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏üíª

–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
- **Golang v1.23.5** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
- **telegram-bot-api v5** ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Telegram Bot API.
- **pgx v5** ‚Äî –¥—Ä–∞–π–≤–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL.
- **migrate v4.18.2** ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
- **godotenv v1.5** - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π.
- **Docker** - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏.

---

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–æ—Ç‚ùì

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ø–µ—Ä–≤—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –ª–∏ –æ–Ω.
```golang
if v, err := s.DataBase.GetState(ID, ctx); v == 0 || errors.Is(err, pgx.ErrNoRows) {
	name := update.Message.From.UserName
	err := s.DataBase.NewUser(ID, name, name, ctx)
	if err != nil {
   	   s.sendErr(ID)
	   continue
	}
	slog.Info("New User!", "ChatId", ID, "Username", update.Message.From.UserName)
}
```
2. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–æ–≤—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è**, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é —Å—Ç—Ä–æ—á–∫—É –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
```golang
func (d PostgresDb) NewUser(chatId int64, userName, tag string, ctx context.Context) error {
	tx, err := d.Pool.BeginTx(ctx, pgx.TxOptions{IsoLevel: pgx.Serializable})
	if err != nil {
		return err
	}
	defer tx.Rollback(ctx)

	var userExists bool
	err = tx.QueryRow(ctx, `SELECT EXISTS(SELECT 1 FROM users WHERE chatid = $1);`,
	chatId).Scan(&userExists)
	if err != nil {
		return err
	}
	if userExists {
		return UserExistsErr
	}
	err = d.Pool.QueryRow(context.Background(), `INSERT INTO Users (ChatId, Name ,Tag ) VALUES ($1, $2 , $3);`,
		chatId, userName, tag).Scan()
	if err != nil {
		return err
	}
	err = tx.Commit(ctx)
	if err != nil {
		return err
	}
	return nil
}
```
3. –î–∞–ª–µ–µ –∏–¥–µ—Ç switch case , –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è , –∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã.
```golang
go func(chatId int64, msgIn string, upd tgAPI.Update, state int) {
	ctxForSwitch, cancel := context.WithTimeout(context.Background(), time.Second*40)
	defer cancel()
	switch state {
	case consts.NothingState:
	case consts.StartState:
	case consts.AskNameState:
	case consts.AddFriendState:
	case consts.DelFriendState:
	case consts.UpdateNameState:
	case consts.MessageForAllState:
        }
}(ID, msg, update, st)
```
4. –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å , —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º **1 - StartState** , –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –º–µ—Ç–æ–¥ startSwitch.
```golang
func (s *BotServ) startSwitch(chatId int64, ctx context.Context) error {
	const op = "botMethod:startSwitch"
	botMsg := tgAPI.NewMessage(chatId, "–ó–¥—Ä–∞–≤—Å—Ç—É–π –¥–æ—Ä–æ–≥–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å!\n–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç‚ùî")
	s.Bot.Send(botMsg)
	err := s.DataBase.UpdateState(chatId, consts.AskNameState, ctx)
	if err != nil {
		botMsg := tgAPI.NewMessage(chatId, "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞!\n–ü–æ—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑")
		s.Bot.Send(botMsg)
		s.logger.Error("Cant update state of user", "Operation", op, "ChatId", chatId, "Error", err)
		return err
	}
	return nil
}
```


### –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è‚è≥


–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π (`state`). –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è `state`, –±–æ—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è.
```golang
const (
	StartState         = iota + 1 //1
	NothingState                  //2
	AskNameState                  //3
	EditNameState                 //4
	AddFriendState                //5
	DelFriendState                //6
	UpdateNameState               //7
	MessageForAllState            //8
)
```

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏üí¨
   ![–ë–µ–∑ –∏–º–µ–Ω–∏-1](https://github.com/user-attachments/assets/3885811a-55cb-4210-b04e-caccd06d42c4)


1. **–û—Ç–ø—Ä–∞–≤–∫–∞ "–ô–û–£!"**:
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –Ω–∞ –∫–Ω–æ–ø–∫—É , –ø–æ—Å–ª–µ —á–µ–≥–æ –±–æ—Ç –±–µ—Ä–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –µ–≥–æ –¥—Ä—É–∑–µ–π –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º –∏–º –ô–æ—É.
   ![–ô–æ—É!](https://github.com/user-attachments/assets/2b4d52ca-c65d-4b70-aded-5af0e662f3a9)
   - –¢–∞–∫ –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ô–æ—É! –ø—Ä–∏–∫—Ä–µ–ø–∏–≤ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é , –¥–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –Ω–∞—Ö–æ–¥—è—Å—å –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é.
   ![–ô–æ—É! —Å —Ñ–æ—Ç–æ](https://github.com/user-attachments/assets/d44a385d-1ce9-43bb-9090-e3a5c2114897)



2. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–∑–µ–π**:
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –¥—Ä—É–∑–µ–π, —É–∫–∞–∑—ã–≤–∞—è –∏—Ö **tag**.
   ![–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –¥—Ä—É–∑—å—è](https://github.com/user-attachments/assets/246a6220-51e9-4b6e-96c5-7c189de343bd)
   - –ò –Ω–µ –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö.
   ![–£–∂–µ –≤ –¥—Ä—É–∑—å—è—Ö](https://github.com/user-attachments/assets/2ab19e5f-9e52-4b36-b917-00fb19c509e2)



3. **–£–¥–∞–ª–µ–Ω–∏–µ –¥—Ä—É–∑–µ–π**:
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –¥—Ä—É–∑–µ–π –∏–∑ —Å–≤–æ–µ–≥–æ —Å–ø–∏—Å–∫–∞, —É–∫–∞–∑—ã–≤–∞—è –∏—Ö **tag**.
   ![–£–¥–∞–ª–µ–Ω–∏–µ –¥—Ä—É–≥–∞](https://github.com/user-attachments/assets/8a9ed899-fcd3-44c9-bf1a-2cd3fd8040aa)
   - –ò, —Ç–æ—á–Ω–æ —Ç–∞–∫ –∂–µ –∫–∞–∫ –∏ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –¥—Ä—É–∑–µ–π, –Ω–µ –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –¥—Ä—É–≥–∞.
   ![–Ω–µ—Ç –¥—Ä—É–≥–∞](https://github.com/user-attachments/assets/02d30d1b-9cac-44d7-aee8-e4444359b551)



4. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏**:
   - –ü–æ–ª—å–∑–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Å–≤–æ–µ –∏–º—è –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é, –Ω—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏—Å–ª–∞—Ç—å –Ω–æ–≤–æ–µ –∏–º—è.
   ![–º–µ–Ω—è—é –∏–º—è](https://github.com/user-attachments/assets/1a0a54d9-b6f7-4975-8da5-578be2dbdfc9)

     

5. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥—Ä—É–∑–µ–π**:
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ—Ö —Å–≤–æ–∏—Ö –¥—Ä—É–∑–µ–π, –æ—Ç –∫–æ–≥–æ –∏ –∫–æ–º—É –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –ô–æ—É.
   ![—Å–ø–∏—Å–æ–∫](https://github.com/user-attachments/assets/984813cf-0896-4a7d-bc69-0b05cb2fb6f3)



---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Öüìã

### –¢–∞–±–ª–∏—Ü–∞ `Users`
| –ü–æ–ª–µ     | –¢–∏–ø      | –û–ø–∏—Å–∞–Ω–∏–µ                     |
|----------|----------|------------------------------|
| `chatId` | BIGINT  | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —á–∞—Ç–∞ (primary key). |
| `tag`    | TEXT     | –¢–µ–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.            |
| `name`   | TEXT     | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.            |
| `state`  | INTEGER  | –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. |


### –¢–∞–±–ª–∏—Ü–∞ `Friends`
| –ü–æ–ª–µ         | –¢–∏–ø      | –û–ø–∏—Å–∞–Ω–∏–µ                     |
|--------------|----------|------------------------------|
| `Id`         | SERIAL   | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ (primary key). |
| `chatId`     | BIGINT  | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. |
| `ScndChatId` | BIGINT  | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤—Ç–æ—Ä–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. |

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫üöÄ

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π **Go** (–≤–µ—Ä—Å–∏—è 1.20 –∏–ª–∏ –≤—ã—à–µ).
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –≤—ã—à–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.
- –¢–æ–∫–µ–Ω Telegram Bot API.

### –®–∞–≥–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞
1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
   ```bash
   git clone https://github.com/lingSmr/Yo-tg-bot-.git
   cd yo-telegram-bot
   ```
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   go mod download
3. –ü–æ–¥–Ω–∏–º–∏—Ç–µ docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   ```bash
   docker compose up -d
4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ src/cmd, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ **.env** —Ñ–∞–π–ª –∏ —Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É
   ```bash
   cd src/cmd
   nano .env
   go build -o ""Yo
   ./Yo
   

---

## –õ–∏—Ü–µ–Ω–∑–∏—è
–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT.
